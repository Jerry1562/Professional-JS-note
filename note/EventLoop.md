# JS的事件循环 #

Javascript是一种单线程的语言，为了确保运行的效率，必须引入异步机制。异步机制针对的是一些需要等待的操作，比如说等待Http请求的响应。
JS通过事件循环实现了异步机制。  

事件循环需要有3个栈：执行栈、宏任务栈、微任务栈。

## 事件循环流程 ##
1. 主程序进入执行栈，开始执行。（主程序本身也是宏任务的一种）
2. 在执行过程中，会产生一系列的异步操作，程序不会等待异步操作返回结果，一直执行直到执行栈清空（**“非阻塞特性”**）
3. 当异步操作返回结果时，JS引擎会把对应的回调函数放入宏任务栈或微任务栈中。
4. 执行栈清空后，会把微任务栈中所有的任务压入执行栈中，直到微任务栈清空。
5. 把宏任务栈中的第一个宏任务压入执行栈执行，产生的宏任务和微任务又压入宏任务或微任务栈中。
6. 重复步骤4、5直到所有栈都被清空，程序结束。

### 要点 ###
每次执行栈清空，首先检查微任务栈，只要微任务栈未被清空，宏任务栈的内容就不会被执行。宏任务是取出一个，执行一个。微任务是一次性取出全部，执行全部。记住他们的优先级：**执行栈>微任务栈>宏任务栈**

## 微任务与宏任务的分类 ##

### 宏任务 ###
|                       | 浏览器 | Node |
| :-------------------: | :----: | :--: |
|      setTimeout       |   √    |  √   |
|      setInterval      |   √    |  √   |
|     setImmediate      |   x    |  √   |
| requestAnimationFrame |   √    |  x   |

### 微任务 ###
|                            | 浏览器 | Node |
| :------------------------: | :----: | :--: |
|      process.nextTick      |   x    |  √   |
|      MutationObserver      |   √    |  x   |
| Promise.then catch finally |   √    |  √   |
